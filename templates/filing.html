{% extends "base.html" %}

{% block content %}
<div class="card shadow-sm">
    <div class="card-header bg-primary text-white">
        <h1 class="card-title h3 mb-0">Filing Details for {{ filing.accession_number }}</h1>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <p><strong>CIK:</strong> {{ filing.cik_number }}</p>
                <p><strong>Filing Date:</strong> {{ filing.filing_date }}</p>
                <p><strong>File Number:</strong> {{ filing.file_number }}</p>
                <p><strong>File Directory:</strong> <a href="https://sec.gov/{{ filing.filing_directory }}"
                        target="_blank">{{
                        filing.filing_directory }}</a></p>
                <p><a target="_blank" href="{{ url_for('company_detail', cik=filing.cik_number) }}">Filing
                        History</a></p>
            </div>
            <div class="col-md-6">
                <p><strong>Company Name:</strong>
                    {% if filing.cik %}
                    <a href="{{ url_for('company_detail', cik=filing.cik) }}">{{ filing.company_name
                        }}</a>
                    {% else %}
                    {{ filing.company_name }}
                    {% endif %}
                </p>
                <p><strong>Form Type:</strong> {{ filing.form_type }}</p>
                <p><strong>Reporting Period:</strong> {{ filing.period_of_report }}</p>
                <p><strong>Created At:</strong> {{ filing.created_at | human_date }}</p>
                <p><strong>Updated At:</strong> {{ filing.updated_at | human_date }}</p>
            </div>
        </div>
    </div>
</div>

<h2 class="mt-4 mb-3">Holdings</h2>
<div class="table-responsive">
    <table id="holdings-table" class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Issuer Name</th>
                <th>CUSIP</th>
                <th>Title of Class</th>
                <th>Value ($)</th>
                <th>Shares</th>
                <th>Share Type</th>
                <th>Investment Discretion</th>
                <th>Put Call</th>
                <th>Voting (Sole)</th>
                <th>Voting (Shared)</th>
                <th>Voting (None)</th>
            </tr>
        </thead>
        <tbody>
            {% for holding in holdings %}
            <tr>
                <td>{{ holding.issuer_name }}</td>
                <td>{{ holding.cusip }}</td>
                <td>{{ holding.title_of_class }}</td>
                <td>{{ "{:,.0f}".format(holding.value) if holding.value else "N/A" }}</td>
                <td>{{ "{:,.0f}".format(holding.shares_or_principal_amount) if holding.shares_or_principal_amount else
                    "N/A" }}</td>
                <td>{{ holding.shares_or_principal_type or "N/A" }}</td>
                <td>{{ holding.investment_discretion or "N/A" }}</td>
                <td>{{ holding.put_or_call or "N/A" }}</td>
                <td>{{ holding.voting_authority_sole or "N/A" }}</td>
                <td>{{ holding.voting_authority_shared or "N/A" }}</td>
                <td>{{ holding.voting_authority_none or "N/A" }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="11" class="text-center">No holdings found for this filing.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
<script type="text/javascript" charset="utf8"
    src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" charset="utf8"
    src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

<script>
    $(document).ready(function () {
        $('#holdings-table').DataTable({
            "processing": true,
            "serverSide": true,
            "ajax": {
                "url": "{{ url_for('get_holdings_data', accession_number=filing.accession_number) }}",
                "type": "GET",
                "dataSrc": "data"
            },
            "columns": [
                { "data": "issuer_name" },
                { "data": "cusip" },
                { "data": "title_of_class" },
                { "data": "value" },
                { "data": "shares_or_principal_amount" },
                { "data": "shares_or_principal_type" },
                { "data": "investment_discretion" },
                { "data": "put_or_call" },
                { "data": "voting_authority_sole" },
                { "data": "voting_authority_shared" },
                { "data": "voting_authority_none" }
            ],
            "columnDefs": [
                {
                    "targets": 3,
                    "render": function (data, type, row) {
                        return type === 'display' && data !== null ? new Intl.NumberFormat('en-US').format(data) : data;
                    }
                },
                {
                    "targets": 4,
                    "render": function (data, type, row) {
                        return type === 'display' && data !== null ? new Intl.NumberFormat('en-US').format(data) : data;
                    }
                },
                { "orderable": true, "targets": [0, 1, 2, 3, 4] },
                { "orderable": false, "targets": [5, 6, 7, 8, 9, 10] }
            ],
            "pageLength": 25,
            "lengthMenu": [10, 25, 50, 100],
            "order": [[3, 'desc']]
        });
    });
</script>
{% endblock %}